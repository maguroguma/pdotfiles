-- PLUGSETTING: zbirenbaum/copilot.lua
require('copilot').setup({
  panel = {
    enabled = true,
    auto_refresh = false,
    keymap = {
      jump_prev = "[[",
      jump_next = "]]",
      accept = "<CR>",
      refresh = "gr",
      open = "<M-CR>"
    },
    layout = {
      position = "bottom", -- | top | left | right
      ratio = 0.4
    },
  },
  suggestion = {
    enabled = true,
    auto_trigger = true, -- default: false
    debounce = 75,
    keymap = {
      accept = "<C-k>", -- default : <M-l>
      accept_word = false,
      accept_line = false,
      next = "<Nop>",
      prev = "<C-o>",
      dismiss = "<C-]>",
    },
  },
  filetypes = {
    yaml = true,
    markdown = true,
    help = true,
    gitcommit = true,
    gitrebase = true,
    lua = true,
    vim = true,
    javascript = true,
    typescript = true,
    vue = true,
    html = true,
    go = true,
    ["*"] = false,
  },
  copilot_node_command = 'node', -- Node.js version must be > 18.x
  server_opts_overrides = {},
})

-- PLUGSETTING: CopilotC-Nvim/CopilotChat.nvim
require("CopilotChat").setup {
  debug = true, -- Enable debugging
  -- See Configuration section for rest

  question_header = '## ğŸ™‹ğŸ™‹ğŸ™‹ User ğŸ™‹ğŸ™‹ğŸ™‹', -- Header to use for user questions
  answer_header = '## ğŸ¤–ğŸ¤–ğŸ¤– Copilot ğŸ¤–ğŸ¤–ğŸ¤–', -- Header to use for AI answers
  error_header = '## âš ï¸âš ï¸âš ï¸ Error âš ï¸âš ï¸âš ï¸', -- Header to use for errors

  prompts = {
    Explain = {
      prompt = '/COPILOT_EXPLAIN é¸æŠéƒ¨åˆ†ã®ã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦èª¬æ˜ã—ã¦ãã ã•ã„ã€‚',
    },
    -- Review = {
    --   prompt = '/COPILOT_REVIEW Review the selected code.',
    --   callback = function(response, source)
    --     -- see config.lua for implementation
    --   end,
    -- },
    Fix = {
      prompt = '/COPILOT_GENERATE ã“ã®ã‚³ãƒ¼ãƒ‰ã«ã¯å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚ãƒã‚°ã‚’ä¿®æ­£ã—ãŸã‚³ãƒ¼ãƒ‰ã«æ›¸ãæ›ãˆã¦ãã ã•ã„ã€‚',
    },
    Optimize = {
      prompt = '/COPILOT_GENERATE é¸æŠéƒ¨åˆ†ã®ã‚³ãƒ¼ãƒ‰ã‚’æœ€é©åŒ–ã—ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨å¯èª­æ€§ã‚’å‘ä¸Šã•ã›ã¦ãã ã•ã„ã€‚',
    },
    Docs = {
      prompt = '/COPILOT_GENERATE é¸æŠéƒ¨åˆ†ã®ã‚³ãƒ¼ãƒ‰ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›¸ã„ã¦ãã ã•ã„ã€‚å…·ä½“çš„ã«ã¯ã€ã€Œãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦è¿½åŠ ã—ãŸã€å…ƒã®ã‚³ãƒ¼ãƒ‰ã‚’å«ã‚€ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã€ã§å›ç­”ã—ã¦ãã ã•ã„ã€‚ã¾ãŸã€ä½¿ç”¨ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã«æœ€ã‚‚é©ã—ãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šJavaScriptã®JSDocã€Pythonã®docstringsãªã©ï¼‰',
    },
    Tests = {
      prompt = '/COPILOT_GENERATE é¸æŠéƒ¨åˆ†ã®ã‚³ãƒ¼ãƒ‰ã®ã€å˜ä½“ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ãã ã•ã„ã€‚',
    },
    -- FixDiagnostic = {
    --   prompt = 'Please assist with the following diagnostic issue in file:',
    --   selection = select.diagnostics,
    -- },
    -- Commit = {
    --   prompt = 'Write commit message for the change with commitizen convention. Make sure the title has maximum 50 characters and message is wrapped at 72 characters. Wrap the whole message in code block with language gitcommit.',
    --   selection = select.gitdiff,
    -- },
    CommitStaged = {
      prompt = [[Write commit message for the change with commitizen convention.
Make sure the title has maximum **50 characters** and message is wrapped at **72 characters**.
Wrap the whole message in code block with language gitcommit.

Also, please use the following word and emoji as prefix for the title:

feat âœ¨      feature
fix ğŸ›       bug fix
deps â•      add dependencies
deps â–      remove dependencies
breaking ğŸ’¥  breaking changes
docs ğŸ“      documentation
style ğŸ’„     formatting, missing semi colons, etc
refactor â™»ï¸   refactoring
test âœ…      when adding missing tests
chore âœï¸      maintain

ã¾ãŸã€ã‚¿ã‚¤ãƒˆãƒ«ã® prefix ã¯ãã®ã¾ã¾ã¨ã—ã¦ã€ã‚¿ã‚¤ãƒˆãƒ«ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ—¥æœ¬èªã«ç¿»è¨³ã—ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚‚å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
]],
    },
  },

  window = {
    layout = 'horizontal', -- 'vertical', 'horizontal', 'float', 'replace'
  },

  -- default mappings
  mappings = {
    complete = {
      detail = 'Use @<Tab> or /<Tab> for options.',
      insert ='<Tab>',
    },
    close = {
      normal = 'q',
      insert = '<Nop>'
    },
    reset = {
      normal ='<C-l>',
      insert = '<Nop>'
    },
    submit_prompt = {
      normal = '<C-j>',
      insert = '<C-j>'
    },
    accept_diff = {
      normal = '<C-y>',
      insert = '<Nop>'
    },
    yank_diff = {
      normal = 'gy',
    },
    show_diff = {
      normal = 'gd'
    },
    show_system_prompt = {
      normal = 'gp'
    },
    show_user_selection = {
      normal = 'gs'
    },
  },
}

-- ãƒãƒƒãƒ•ã‚¡ã®å†…å®¹å…¨ä½“ã‚’ä½¿ã£ã¦ Copilot ã¨ãƒãƒ£ãƒƒãƒˆã™ã‚‹
function CopilotChatBuffer()
  local input = vim.fn.input("Quick Chat: ")
  if input ~= "" then
    require("CopilotChat").ask(input, { selection = require("CopilotChat.select").buffer })
  end
end

-- normal
vim.api.nvim_set_keymap("n", "<leader>cco", "<cmd>CopilotChatOpen<cr>", { noremap = true, silent = true })
vim.api.nvim_set_keymap("n", "<leader>cct", "<cmd>CopilotChatToggle<cr>", { noremap = true, silent = true })
vim.api.nvim_set_keymap("n", "<leader>ccs", "<cmd>CopilotChatStop<cr>", { noremap = true, silent = true })
vim.api.nvim_set_keymap("n", "<leader>ccr", "<cmd>CopilotChatReset<cr>", { noremap = true, silent = true })
vim.api.nvim_set_keymap("n", "<leader>ccc", "<cmd>CopilotChatCommitStaged<cr>", { noremap = true, silent = true })

-- visual
vim.api.nvim_set_keymap('v', '<leader>cce', ':CopilotChatExplain<CR>', { noremap = true, silent = true })
vim.api.nvim_set_keymap('v', '<leader>ccd', ':CopilotChatDocs<CR>', { noremap = true, silent = true })

-- Copilot Chat Quick: ç¾åœ¨ã®ãƒãƒƒãƒ•ã‚¡ã‚’å…¥åŠ›ã«ã—ã¦ Copilot ã¨ãƒãƒ£ãƒƒãƒˆã™ã‚‹
vim.api.nvim_set_keymap("n", "<leader>ccq", "<cmd>lua CopilotChatBuffer()<cr>", { noremap = true, silent = true })
