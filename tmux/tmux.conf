bind C-r source-file $XDG_CONFIG_HOME/tmux/tmux.conf \; display "Reloaded!"

#############################
# other settings
#############################

# prefixキーをC-aに変更する
set -g prefix C-t

# C-bのキーバインドを解除する
unbind C-b

# キーストロークのディレイを減らす
set -sg escape-time 1

# C-t*2でtmux内のプログラムにC-tを送る
bind C-t send-prefix

# '|' でペインを縦に、'-' でペインを横に分割する
bind | split-window -h -c '#{pane_current_path}'
bind - split-window -v -c '#{pane_current_path}'
bind = select-layout even-horizontal

# Vimのキーバインドでペインを移動する
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R
bind -r C-h select-window -t :-
bind -r C-l select-window -t :+

# sessionの作成（セッション名はprefix -> $で変更可能）
bind c new-session
bind-key r command-prompt -p "change session name to:" "rename-session '%%'"

# window の作成
bind t new-window

# Vimのキーバインドでペインをリサイズする
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# ペインを数字で選べるようにする
# ref: https://qiita.com/pocari/items/b1828c8aea8e3545cadd
bind C-o display-panes
bind q display-panes
set -g display-panes-time 10000

# 全ペイン同期をトグルする
# ref: https://qiita.com/waieneiaw/items/22ed18809739c9a69f25
bind a setw synchronize-panes \; display "synchronize-panes #{?pane_synchronized,on,off}"

# popupでlazygitを開く（-EオプションがないとESCでpopupがクローズしてしまう）
bind g popup -w95% -h95% -E -d "#{pane_current_path}" lazygit
bind f popup -w95% -h95% -E -d "#{pane_current_path}" vifm
bind s run -b tmux-session-fzf

bind p switch-client -l

# マウス操作を有効にする
setw -g mouse on

set -g default-terminal "screen-256color"  # 基本的にはscreen-256colorかtmux-256colorを設定
set-option -ga terminal-overrides ",$TERM:Tc" # tmuxを起動していない時のzshでの$TERMの値を指定

# ステータスバーの色を設定する
# set -g status-style fg=white,bg=black

# ウィンドウリストの色を設定する
# setw -g window-status-style fg=cyan,bg=default,dim
# アクティブなウィンドウを目立たせる
# setw -g window-status-current-style fg=white,bg=red,bright

# pane border
set-option -g pane-border-status bottom
# #1c1c1c
# #89faa0
# #f6fa89
# #facb89
# #faa589
# #b728c7

set-option -g pane-border-format "#{?pane_active,#[bold]\
#[fg=#b728c7]#[bg=#89faa0]\
#[fg=#1c1c1c]#[bg=#89faa0] W:#I P:#P #[fg=#89faa0]#[bg=#f6fa89]\
#[fg=#1c1c1c]#[bg=#f6fa89] #{pane_current_command} \
#{?pane_in_mode,\
#[fg=#f6fa89]#[bg=#facb89]#[fg=#1c1c1c]#[bg=#facb89]\
 COPY #{?selection_active,SELECTING ,}#{?search_present,SEARCHING ,}\
#[fg=#facb89]#[bg=#b728c7],\
#[fg=#f6fa89]#[bg=#b728c7]}\
,\
#[fg=#1c1c1c]#[bg=black]\
 W:#I P:#P  #{pane_current_command} \
#{?pane_in_mode,\
 COPY #{?selection_active,SELECTING ,}#{?search_present,SEARCHING ,},}\
#[fg=black]#[bg=#1c1c1c]\
}"

set-option -g pane-border-style fg=white,bg=black #base2
set-option -g pane-active-border-style fg=#b728c7,bg=#b728c7 #base1

# コマンドラインの色を設定する
# set -g message-style fg=white,bg=black,bright

# ステータスバーを設定する
set -g status-left-length 100
set -g status-right-length 100

set -g status-left "#{?client_prefix,#[reverse],}\
#[bold,fg=#1c1c1c,bg=#89faa0] #S #[fg=#1c1c1c,bg=#faa589] %Y-%m-%d(%a) %H:%M \
#{?pane_synchronized,#[fg=#ffffff]#[bg=#b728c7] SYNC ,}\
#{?window_zoomed_flag,#[fg=#ffffff]#[bg=#b728c7]#[fg=#ffffff] ZOOM ,}\
"

set -g status-right "#{?client_prefix,#[reverse],}#[bold]\
#{?pane_in_mode,#[fg=#1c1c1c]#[bg=#faa589] COPY ,}\
#{?selection_active,#[fg=#1c1c1c]#[bg=#faa589] SELECTING ,}\
#{?search_present,#[fg=#1c1c1c]#[bg=#faa589] SEARCH ,}\
"

## リフレッシュの間隔を設定する(デフォルト 15秒)
set -g status-interval 60
## ウィンドウリストの位置を中心寄せにする
set -g status-justify centre
## ヴィジュアルノーティフィケーションを有効にする
setw -g monitor-activity on
set -g visual-activity on
## ステータスバーを上部に表示する
set -g status-position top

#############################
# bind -n
#############################

# claude code などのための設定
# https://eiji.page/blog/editprompt-intro/
# bind -n は tmux prefix を要求しないキーマップを設定する
bind -n M-o run-shell 'tmux split-window -v -l 20 \
  -c "#{pane_current_path}" \
  "editprompt --editor nvim --target-pane #{pane_id}"'
bind o run-shell 'tmux split-window -v -l 20 \
  -c "#{pane_current_path}" \
  "editprompt --editor nvim --target-pane #{pane_id}"'

bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R
bind -n M-z resize-pane -Z

# prefix + [ のコピーモードを明示的に vi モードとする
set-window-option -g mode-keys vi
# コピーモードで JK を 10倍移動にする
bind-key -T copy-mode-vi J send-keys -N10 -X cursor-down
bind-key -T copy-mode-vi K send-keys -N10 -X cursor-up
# H, Lキーを行頭・行末移動に変更
bind-key -T copy-mode-vi H send -X start-of-line
bind-key -T copy-mode-vi L send -X end-of-line
# カーソル位置に一気にスクロールする
bind-key -T copy-mode-vi 't' send-keys -X scroll-top
bind-key -T copy-mode-vi 'z' send-keys -X scroll-middle
bind-key -T copy-mode-vi 'b' send-keys -X scroll-bottom

#### Ubuntu

# クリップボードにヤンクする
# https://qiita.com/yuki-k/items/2a28b40f0bd49b2bcb21
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "xsel -ip && xsel -op | xsel -ib"
bind -T copy-mode-vi Enter send -X copy-pipe-and-cancel "xsel -ip && xsel -op | xsel -ib"
